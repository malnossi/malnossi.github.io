<!doctype html>
<html class="not-ready lg:text-base overflow-y-scroll scroll-pt-14 scheme-light dark:scheme-dark" lang="en">

<head prefix="og: https://ogp.me/ns# article: https://ogp.me/ns/article#">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="generator" content="Zola v0.21.0" />
  <title>Fast &amp; Efficient Bulk Create with Django and PostgreSQL</title>
  <meta property="og:title" content="Fast &amp; Efficient Bulk Create with Django and PostgreSQL" />
  <meta name="description" content="Building scalable back‑ends requires smart data ingestion. This guide shows how to stream large API datasets into PostgreSQL with Django’s bulk_create and the database COPY command.  It compares perfo…" />
  <meta property="og:description" content="Building scalable back‑ends requires smart data ingestion. This guide shows how to stream large API datasets into PostgreSQL with Django’s bulk_create and the database COPY command.  It compares performance and memory use and explains why streaming is essential for handling remote, messy and big dat…" />
  <meta property="og:url" content="https://malnossi.github.io/blog/beyond-django-bulk-create/" />
  <link rel="canonical" href="https://malnossi.github.io/blog/beyond-django-bulk-create/" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2025-10-30T00:00:00+00:00" />
  <meta property="article:tag" content="Django" />
  <meta property="article:tag" content="PostgreSQL" />
  <meta property="article:tag" content="Data" />
  <meta property="og:image" content="https://malnossi.github.io/djangopostgres.png" />
  <meta property="og:image:alt" content="" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="675" />
  <meta property="og:image:type" content="image/png" />
  <link rel="alternate" type="application/atom+xml" href="https://malnossi.github.io/atom.xml" title="Atom" />
  <!-- Begin Head inject -->
  
  <!-- End Head inject -->
  <link rel="stylesheet" href="https://malnossi.github.io/main.min.css?h=a74dd0c65eed2d85f55f" />
  <link rel="stylesheet" href="https://malnossi.github.io/icons.css?h=7dd5ab449fa840fc01e2" />
  <style>:root{--bg: #f4f4f5; --header: #e4e4e7;} :root.dark{--bg: #18181b; --header: #27272a;}</style>
  <meta name="theme-color" data-light="#e4e4e7" data-dark="#27272a" content="#e4e4e7" />
  <link rel="icon" type="image/x-icon" href="https://malnossi.github.io/favicon.ico" />
  <link rel="apple-touch-icon" type="image/png" href="https://malnossi.github.io/apple-touch-icon.png?h=58bee300054c5308feb3" />
  <link rel="icon" type="image/png" href="https://malnossi.github.io/android-icon.png?h=8d80ec95446bd2c36826" />
  <script src="https://malnossi.github.io/js/zola-theme.min.js?h=26975b146d48e6ff41af"></script>
  <!-- Begin Head End inject -->
  
<meta name="author" content="Mohamed Nossirat©">
<meta property="article:author" content="Mohamed Nossirat©">
<meta name="twitter:creator" content="Mohamed Nossirat©">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-8LBRDGLXJV"></script>
<script>
  // (Optional) default deny until consent tool flips it to granted
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('consent', 'default', { analytics_storage: 'denied' });
  gtag('js', new Date());
  gtag('config', 'G-8LBRDGLXJV', {
    anonymize_ip: true
  });
</script>


  <!-- End Head End inject -->
</head>

<body class="text-black duration-100 ease-out dark:text-white">
  <!-- Header -->
<header class="header fixed top-0 z-40 mx-auto min-h-13 w-full">
  <div class="mx-auto w-full max-w-4xl p-2.5 lg:flex lg:justify-between">
    <div class="flex justify-between">
      <div class="flex items-center min-h-8 overflow-hidden">
        <button type="button" title="Go to home page [Alt + !]" accesskey="!"
          onclick="window.location.href='https://malnossi.github.io/';"
          class="btn-home h-6 w-6 shrink-0 cursor-pointer text-[0px]
            bg-center bg-no-repeat bg-cover [background-image:var(--icons-home,url(icons/home.svg))] dark:invert"
        ></button>
        <button type="button" title="Switch color scheme [Alt + $]" accesskey="$"
          onclick="window.zolaTheme.color.toggle();"
          class="btn-dark ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0px]
            bg-center bg-no-repeat bg-cover [background-image:var(--icons-btn-dark,url(icons/btn-dark.svg))]
            dark:[background-image:var(--icons-btn-light,url(icons/btn-light.svg))] dark:invert"
        ></button>
        <button type="button" title="Open search [Alt + /]" accesskey="/"
          onclick="window.zolaTheme.search.toggle();"
          class="btn-search ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0px]
            bg-center bg-no-repeat bg-cover [background-image:var(--icons-search,url(icons/search.svg))] dark:invert"
        ></button>
      </div>
      <div title="Toggle menu [Alt + `+`]" role="button" accesskey="+" tabindex="0"
        class="btn-menu relative z-50 flex h-8 w-8 shrink-0 cursor-pointer select-none flex-col items-center justify-center gap-2.5 lg:hidden"
        onclick="window.zolaTheme.menu.toggleHeader();"
        onkeydown="(event.keyCode == 13 || event.keyCode == 32) ? event.preventDefault() || window.zolaTheme.menu.toggleHeader() : true;"
      ></div>
    </div>
    <nav class="flex w-full items-center lg:w-auto">
      <menu
        class="nav-wrapper flex w-full flex-col py-2 lg:w-auto lg:flex-row lg:self-center lg:py-0">
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://malnossi.github.io/blog/"
          >Blog</a>
        </li>
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://malnossi.github.io/tags/"
          >Tags</a>
        </li>
      </menu>
      <!-- Begin Header Nav inject -->
      
      <!-- End Header Nav inject -->
    </nav>
  </div>
</header>

  <!-- Begin Body Start inject -->
  
  <!-- End Body Start inject -->
  <main class="prose prose-neutral dark:prose-invert prose-pre:rounded-lg prose-img:rounded-lg
    relative mx-auto min-h-[calc(100vh-4rem)] max-w-3xl px-4 pt-28 lg:pt-32 pb-12 wrap-break-word">
      <!-- Search -->
<div id="linkita-search-wrapper" class="hidden">
  <ul id="linkita-search-results"></ul>
</div>
<script>window.zolaTheme.search.init({ scripts: ["https://malnossi.github.io/elasticlunr.min.js", "https://malnossi.github.io/search_index.en.js"], arg: { w: "#linkita-search-wrapper", r: "#linkita-search-results" } });</script>

    
<article>
  <!-- Begin Page Start inject -->
  
  <!-- End Page Start inject -->

  <header class="mb-16">
    <h1 class="my-0! pb-2.5">Fast &amp; Efficient Bulk Create with Django and PostgreSQL</h1>
    <!-- Page Info -->
<div class="text-sm antialiased opacity-80"><time
      datetime="2025-10-30T00:00:00+00:00">2025-10-30</time><span
        class="middot"></span><time
    datetime="PT0H10M0S">10&nbsp;min</time><span
      class="middot"></span><span>Mohamed Nossirat</span>
</div>

  </header>
  <figure class="mt-0 mb-12">
    <img
      class="h-auto w-full rounded-lg"
      src="https://malnossi.github.io/djangopostgres.png"
      width="1200"
      height="675"
    />
  </figure>
  <!-- TOC -->
<nav class="block-bg prose-a:secondary-link mb-12 rounded-lg p-2 text-lg">
  <details>
    <summary class="select-none py-0.5 lg:py-1 pl-3.5" title="[Alt + =]" accesskey="=">
      <span class="cursor-pointer ml-0.5">Table of Contents</span>
    </summary>
    <ul class="ps-8">
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#introduction">Introduction</a>
      </li>
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#setup">Setup</a>
        <ul>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#the-external-api">The External API</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#project-setup">Project Setup</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#docker-for-the-postgresql-database">Docker for the PostgreSQL Database</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#fetch-the-photos-from-the-api">Fetch the photos from the API</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#profile-decorator">Profile decorator</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#implemntation">Implemntation</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#django-orm-bulk-create">Django ORM Bulk Create</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#copy">COPY</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#copy-data-from-a-string-iterator">Copy Data From a String Iterator</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#github-repo">Github Repo</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/beyond-django-bulk-create/#conclusion">Conclusion</a>
          </li>
        </ul>
      </li>
    </ul>
  </details>
</nav>

  <!-- Content -->
  <section><h2 id="introduction"><a class="zola-anchor" href="#introduction" aria-label="Anchor link for: introduction">Introduction</a></h2>
<p>At <a href="https://munityapps.com">Munity</a>, our entire mission revolves around one thing: connecting systems that were never meant to talk to each other. We live and breathe external API integrations pulling data from third-party platforms, transforming it, and making it usable inside modern applications. It sounds straightforward in theory. In practice, it’s controlled chaos.
Every integration comes with its own quirks. Some APIs are beautifully documented, versioned, and predictable. Others behave like relics from a forgotten era inconsistent, rate-limited, half-deprecated, and often missing the one endpoint we actually need. Authentication can range from simple bearer tokens to corporate-grade OAuth labyrinths that break every other week.
And when APIs aren’t available? That’s when the real plumbing begins. We’ve had to fetch data from exported CSVs, ancient FTP servers, even obscure vendor portals that only work in Internet Explorer (yes, still). The reality is that a “modern” integration stack often has to accommodate everything from sleek GraphQL APIs to legacy SOAP endpoints wrapped in enterprise duct tape.
So at Munity, we’ve learned to expect the unexpected. Our work isn’t just about writing connectors it’s about designing resilient systems that can handle inconsistency, scale gracefully, and adapt when external providers change their rules overnight.
In this post, I’ll dive into the common challenges we face building and maintaining these integrations the hidden complexity behind “just connecting an API,” and how we’ve built frameworks at Munity to keep the data flowing no matter how messy the source.</p>
<p>To provide a real-life, workable solution, we start every integration with a few assumptions ground rules that reflect how data actually behaves in the wild:</p>
<ol>
<li>
<p><strong>The Data is Fetched from a Remote Source</strong>
Whether it’s a REST API, S3 bucket, or a private FTP, the data always lives elsewhere. We don’t control its shape, format, or availability — but we must handle it reliably, regardless of latency, authentication quirks, or inconsistent delivery.</p>
</li>
<li>
<p><strong>The Data is Dirty and Needs to Be Transformed</strong>
Even the cleanest APIs leak edge cases. We expect malformed fields, missing relationships, duplicated records, and inconsistent types. Normalization, validation, and transformation aren’t “extra steps” they’re the core of the pipeline.</p>
</li>
<li>
<p><strong>The Data is Big</strong>
Real integrations don’t deal in kilobytes. They deal in gigabytes, sometimes terabytes. That means pagination, batching, streaming, and efficient storage aren’t nice-to-haves they’re essential for performance and scalability.</p>
</li>
</ol>
<p>With these realities in mind, we’ve built our internal frameworks and practices to make external data integration repeatable, predictable, and scalable no matter how messy the source or how complex the system on the other end.</p>
<h2 id="setup"><a class="zola-anchor" href="#setup" aria-label="Anchor link for: setup">Setup</a></h2>
<h3 id="the-external-api"><a class="zola-anchor" href="#the-external-api" aria-label="Anchor link for: the-external-api">The External API</a></h3>
<p>I will use the <a href="https://jsonplaceholder.typicode.com/photos">JSONPlaceholder</a>, it's a fake api and though we could mock an external API call</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">curl</span><span> https://jsonplaceholder.typicode.com/photos
</span></code></pre>
<pre data-lang="json" style="background-color:#2b303b;color:#c0c5ce;" class="language-json "><code class="language-json" data-lang="json"><span>[
</span><span>  {
</span><span>    &quot;</span><span style="color:#a3be8c;">albumId</span><span>&quot;: </span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;: </span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">title</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">accusamus beatae ad facilis cum similique qui sunt</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">url</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">https://via.placeholder.com/600/92c952</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">thumbnailUrl</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">https://via.placeholder.com/150/92c952</span><span>&quot;
</span><span>  },
</span><span>  {
</span><span>    &quot;</span><span style="color:#a3be8c;">albumId</span><span>&quot;: </span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;: </span><span style="color:#d08770;">2</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">title</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">reprehenderit est deserunt velit ipsam</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">url</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">https://via.placeholder.com/600/771796</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">thumbnailUrl</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">https://via.placeholder.com/150/771796</span><span>&quot;
</span><span>  },
</span><span>  </span><span style="color:#65737e;">//
</span><span>]
</span></code></pre>
<h3 id="project-setup"><a class="zola-anchor" href="#project-setup" aria-label="Anchor link for: project-setup">Project Setup</a></h3>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">mkdir</span><span> djangopostgres &amp;&amp; </span><span style="color:#96b5b4;">cd</span><span> djangopostgres
</span><span style="color:#bf616a;">uv</span><span> init .
</span><span style="color:#bf616a;">uv</span><span> add django psycopg2-binary
</span><span style="color:#bf616a;">uv</span><span> run django-admin create-project config .
</span></code></pre>
<h3 id="docker-for-the-postgresql-database"><a class="zola-anchor" href="#docker-for-the-postgresql-database" aria-label="Anchor link for: docker-for-the-postgresql-database">Docker for the PostgreSQL Database</a></h3>
<pre data-lang="yml" style="background-color:#2b303b;color:#c0c5ce;" class="language-yml "><code class="language-yml" data-lang="yml"><span style="color:#bf616a;">services</span><span>:
</span><span>  </span><span style="color:#bf616a;">db</span><span>:
</span><span>    </span><span style="color:#bf616a;">image</span><span>: </span><span style="color:#a3be8c;">postgres:18
</span><span>    </span><span style="color:#bf616a;">ports</span><span>:
</span><span>      - </span><span style="color:#a3be8c;">5432:5432
</span><span>    </span><span style="color:#bf616a;">environment</span><span>:
</span><span>      - </span><span style="color:#a3be8c;">POSTGRES_USER=test
</span><span>      - </span><span style="color:#a3be8c;">POSTGRES_PASSWORD=test
</span><span>      - </span><span style="color:#a3be8c;">POSTGRES_DB=django
</span><span>
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">docker</span><span> compsoe up</span><span style="color:#bf616a;"> -d
</span></code></pre>
<p>In the project's <code>settings.py</code> file change the <code>DATABASES</code> dict as follwing:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span>
</span><span style="color:#bf616a;">DATABASES </span><span>= {
</span><span>    &quot;</span><span style="color:#a3be8c;">default</span><span>&quot;: {
</span><span>        &quot;</span><span style="color:#a3be8c;">ENGINE</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">django.db.backends.postgresql</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">NAME</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">django</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">USER</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">test</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">PASSWORD</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">test</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">HOST</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">localhost</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">PORT</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">5432</span><span>&quot;,
</span><span>    }
</span><span>}
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python</span><span> manage.py startapp photos
</span></code></pre>
<p>Add the <code>photos</code>app to the Django's <code>INSTALLED_APPS</code></p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#bf616a;">INSTALLED_APPS </span><span>= [
</span><span>    &quot;</span><span style="color:#a3be8c;">django.contrib.admin</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">django.contrib.auth</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">django.contrib.contenttypes</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">django.contrib.sessions</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">django.contrib.messages</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">django.contrib.staticfiles</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">photos</span><span>&quot;, </span><span style="color:#65737e;"># new
</span><span>]
</span></code></pre>
<p>And modify in the <code>photos</code> application <code>models.py</code> as folllowing:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django.db </span><span style="color:#b48ead;">import </span><span>models
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Photo</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>
</span><span>    title = models.</span><span style="color:#bf616a;">CharField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">255</span><span>)
</span><span>    url = models.</span><span style="color:#bf616a;">URLField</span><span>(</span><span style="color:#bf616a;">max_length</span><span>=</span><span style="color:#d08770;">255</span><span>)
</span><span>    raw_data = models.</span><span style="color:#bf616a;">JSONField</span><span>(</span><span style="color:#bf616a;">default</span><span>=dict)
</span><span>    created = models.</span><span style="color:#bf616a;">DateTimeField</span><span>(</span><span style="color:#bf616a;">auto_now_add</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>    updated = models.</span><span style="color:#bf616a;">DateTimeField</span><span>(</span><span style="color:#bf616a;">auto_now</span><span>=</span><span style="color:#d08770;">True</span><span>)
</span><span>
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        db_table = &quot;</span><span style="color:#a3be8c;">photos</span><span>&quot;
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python</span><span> manage.py makemigraions
</span><span style="color:#bf616a;">python</span><span> manage.py migrate
</span><span>
</span></code></pre>
<p>For this article, I will implement the features in the “management commands” file, but you can imagine that these functions could live in a Celery task or in a gRPC service. for further information about Django's management commands please refer to the <a href="https://docs.djangoproject.com/en/5.2/howto/custom-management-commands/">Documentation</a></p>
<h3 id="fetch-the-photos-from-the-api"><a class="zola-anchor" href="#fetch-the-photos-from-the-api" aria-label="Anchor link for: fetch-the-photos-from-the-api">Fetch the photos from the API</a></h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>requests
</span><span style="color:#b48ead;">from </span><span>typing </span><span style="color:#b48ead;">import </span><span>Iterator, Dict, Any
</span><span>
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_photos</span><span>() -&gt; Iterator[Dict[str, Any]]:
</span><span>    session = requests.</span><span style="color:#bf616a;">Session</span><span>()
</span><span>    response = session.</span><span style="color:#bf616a;">get</span><span>(&quot;</span><span style="color:#a3be8c;">https://jsonplaceholder.typicode.com/photos</span><span>&quot;)
</span><span>    response.</span><span style="color:#bf616a;">raise_for_status</span><span>()
</span><span>    </span><span style="color:#b48ead;">yield from </span><span>response.</span><span style="color:#bf616a;">json</span><span>()
</span></code></pre>
<h3 id="profile-decorator"><a class="zola-anchor" href="#profile-decorator" aria-label="Anchor link for: profile-decorator">Profile decorator</a></h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">profile</span><span>(</span><span style="color:#bf616a;">fn</span><span>):
</span><span>    @</span><span style="color:#bf616a;">wraps</span><span>(fn)
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">inner</span><span>(*</span><span style="color:#bf616a;">args</span><span>, **</span><span style="color:#bf616a;">kwargs</span><span>):
</span><span>        </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&quot;</span><span style="color:#96b5b4;">\n</span><span>{fn.__name__}&quot;)
</span><span>        tracemalloc.</span><span style="color:#bf616a;">start</span><span>()
</span><span>        t0 = time.</span><span style="color:#bf616a;">perf_counter</span><span>()
</span><span>        </span><span style="color:#b48ead;">try</span><span>:
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">fn</span><span>(*args, **kwargs)
</span><span>        </span><span style="color:#b48ead;">finally</span><span>:
</span><span>            elapsed = time.</span><span style="color:#bf616a;">perf_counter</span><span>() - t0
</span><span>            current, peak = tracemalloc.</span><span style="color:#bf616a;">get_traced_memory</span><span>()
</span><span>            tracemalloc.</span><span style="color:#bf616a;">stop</span><span>()
</span><span>            </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&quot;</span><span style="color:#a3be8c;">Time   </span><span>{elapsed</span><span style="color:#d08770;">:0.4f</span><span>}</span><span style="color:#a3be8c;">s</span><span>&quot;)
</span><span>            </span><span style="color:#96b5b4;">print</span><span>(</span><span style="color:#b48ead;">f</span><span>&quot;</span><span style="color:#a3be8c;">Memory </span><span>{peak / (</span><span style="color:#d08770;">1024</span><span>**</span><span style="color:#d08770;">2</span><span>)</span><span style="color:#d08770;">:.3f</span><span>}</span><span style="color:#a3be8c;"> MiB (peak)</span><span>&quot;)
</span><span>
</span><span>    </span><span style="color:#b48ead;">return </span><span>inner
</span></code></pre>
<p>This <code>@profile</code> decorator is a lightweight performance tool that measures how long a function takes to run and how much memory it consumes at its peak. It uses Python’s built-in <code>tracemalloc</code> module to track memory allocations and <code>time.perf_counter()</code> for precise timing. When applied to a function, it starts monitoring before execution, runs the function once, and then reports the total execution time and maximum memory usage in a clean, readable format. It helps identify performance bottlenecks and memory inefficiencies without requiring external profilers.</p>
<h3 id="implemntation"><a class="zola-anchor" href="#implemntation" aria-label="Anchor link for: implemntation">Implemntation</a></h3>
<p>Currently, the Jsonplaceholder Photos API only contains 5,000 entries, so to work with a large dataset, I will multiply the list by 100, giving us 500K entries.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span>&gt;&gt;&gt; photos = </span><span style="color:#bf616a;">list</span><span>(get_photos())</span><span style="color:#bf616a;">*100
</span><span>&gt;&gt;&gt; len(</span><span style="color:#bf616a;">photos</span><span>)
</span><span style="color:#bf616a;">500000
</span></code></pre>
<h3 id="django-orm-bulk-create"><a class="zola-anchor" href="#django-orm-bulk-create" aria-label="Anchor link for: django-orm-bulk-create">Django ORM Bulk Create</a></h3>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span>@</span><span style="color:#bf616a;">profile
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">insert_django_bulk_create</span><span>(</span><span style="color:#bf616a;">photos</span><span>: Iterator[Dict[str, Any]]):
</span><span>
</span><span>    Photo.objects.</span><span style="color:#bf616a;">bulk_create</span><span>(
</span><span>        [
</span><span>            </span><span style="color:#bf616a;">Photo</span><span>(**</span><span style="color:#bf616a;">dict</span><span>(</span><span style="color:#bf616a;">title</span><span>=photo[&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;], </span><span style="color:#bf616a;">url</span><span>=photo[&quot;</span><span style="color:#a3be8c;">url</span><span>&quot;], </span><span style="color:#bf616a;">raw_data</span><span>=photo))
</span><span>            </span><span style="color:#b48ead;">for </span><span>photo </span><span style="color:#b48ead;">in </span><span>photos
</span><span>        ],
</span><span>    )
</span></code></pre>
<p>For this we will have a commande in <code>load_data.py</code>file:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Command</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">BaseCommand</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#96b5b4;">help </span><span>= &quot;</span><span style="color:#a3be8c;">Load Data from External API</span><span>&quot;
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">handle</span><span>(</span><span style="color:#bf616a;">self</span><span>, *</span><span style="color:#bf616a;">args</span><span>, **</span><span style="color:#bf616a;">options</span><span>):
</span><span>        </span><span style="color:#bf616a;">insert_django_bulk_create</span><span>(</span><span style="color:#bf616a;">photos</span><span>=photos)
</span><span>        </span><span style="color:#bf616a;">self</span><span>.stdout.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">self</span><span>.style.</span><span style="color:#bf616a;">SUCCESS</span><span>(&quot;</span><span style="color:#a3be8c;">Successfully Loaded Data to Photos</span><span>&quot;))
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python</span><span> manage.py load_data
</span><span>
</span><span style="color:#bf616a;">insert_django_bulk_create
</span><span style="color:#bf616a;">Time</span><span>   45.0054s
</span><span style="color:#bf616a;">Memory</span><span> 627.871 MiB (peak)
</span><span style="color:#bf616a;">Successfully</span><span> Loaded Data to Photos
</span></code></pre>
<p>The profiling results show that the <code>insert_django_bulk_create</code> function took <strong>45 seconds</strong> to execute and used up to <strong>627.87 MB</strong> of memory at its peak. This indicates that while Django’s <code>bulk_create</code> method efficiently reduces the number of database insert queries, it still consumes a significant amount of memory because all the <code>Photo</code> objects are instantiated and held in memory before being written to the database. Such a large memory footprint and relatively long execution time suggest that this approach may not scale well for very large datasets.</p>
<h3 id="copy"><a class="zola-anchor" href="#copy" aria-label="Anchor link for: copy">COPY</a></h3>
<p>The official PostgreSQL documentation includes a dedicated section on Populating a Database, which highlights that the most efficient method for loading large amounts of data is the <code>COPY</code> command. In Python, the <code>psycopg</code> library offers a convenient interface for this through the <code>copy_from</code> function. Since the COPY command works with CSV input, the idea is to first convert our dataset into a CSV format and then use copy_from to stream the data directly into the database, the Django’s underlying database connection cursor will have <code>copy_from</code>, <code>copy_to</code>, and <code>copy_expert</code> methods available. You can read their full API <a href="https://www.psycopg.org/docs/usage.html#using-copy-to-and-copy-from">documentation</a>.</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>io
</span><span>@</span><span style="color:#bf616a;">profile
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">insert_string_io</span><span>(</span><span style="color:#bf616a;">photos</span><span>: Iterator[Dict[str, Any]]):
</span><span>    columns = (&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">url</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">raw_data</span><span>&quot;)
</span><span>    csv_file_like_object = io.</span><span style="color:#bf616a;">StringIO</span><span>()
</span><span>    </span><span style="color:#b48ead;">for </span><span>photo </span><span style="color:#b48ead;">in </span><span>photos:
</span><span>        csv_file_like_object.</span><span style="color:#bf616a;">write</span><span>(
</span><span>            &quot;</span><span style="color:#a3be8c;">|</span><span>&quot;.</span><span style="color:#bf616a;">join</span><span>((photo[&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;], photo[&quot;</span><span style="color:#a3be8c;">url</span><span>&quot;], json.</span><span style="color:#bf616a;">dumps</span><span>(photo))) + &quot;</span><span style="color:#96b5b4;">\n</span><span>&quot;
</span><span>        )
</span><span>    csv_file_like_object.</span><span style="color:#bf616a;">seek</span><span>(</span><span style="color:#d08770;">0</span><span>)
</span><span>    </span><span style="color:#b48ead;">with </span><span>connection.</span><span style="color:#bf616a;">cursor</span><span>() </span><span style="color:#b48ead;">as </span><span>cursor:
</span><span>        cursor.</span><span style="color:#bf616a;">copy_from</span><span>(csv_file_like_object, &quot;</span><span style="color:#a3be8c;">photos</span><span>&quot;, </span><span style="color:#bf616a;">sep</span><span>=&quot;</span><span style="color:#a3be8c;">|</span><span>&quot;, </span><span style="color:#bf616a;">columns</span><span>=columns)
</span></code></pre>
<p>Change the code in <code>load_data.py</code>file:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Command</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">BaseCommand</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#96b5b4;">help </span><span>= &quot;</span><span style="color:#a3be8c;">Load Data from External API</span><span>&quot;
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">handle</span><span>(</span><span style="color:#bf616a;">self</span><span>, *</span><span style="color:#bf616a;">args</span><span>, **</span><span style="color:#bf616a;">options</span><span>):
</span><span>        </span><span style="color:#65737e;"># insert_django_bulk_create(photos=photos)
</span><span>        </span><span style="color:#bf616a;">insert_string_io</span><span>(</span><span style="color:#bf616a;">photos</span><span>=photos)
</span><span>        </span><span style="color:#bf616a;">self</span><span>.stdout.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">self</span><span>.style.</span><span style="color:#bf616a;">SUCCESS</span><span>(&quot;</span><span style="color:#a3be8c;">Successfully Loaded Data to Photos</span><span>&quot;))
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python</span><span> manage.py load_data
</span><span>
</span><span style="color:#bf616a;">psycopg2.errors.NotNullViolation:</span><span> null value in column &quot;</span><span style="color:#a3be8c;">created</span><span>&quot; of relation &quot;</span><span style="color:#a3be8c;">photos</span><span>&quot; violates not-null constraint
</span><span style="color:#bf616a;">DETAIL:</span><span>  Failing row contains (5001, accusamus beatae ad facilis cum similique qui sunt, https://via.placeholder.com/600/92c952, {&quot;</span><span style="color:#a3be8c;">id</span><span>&quot;: 1, &quot;</span><span style="color:#a3be8c;">url</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">https://via.placeholder.com/600/92c952</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">titl..., null, null).
</span><span style="color:#a3be8c;">CONTEXT:  COPY photos, line 1: </span><span>&quot;accusamus beatae ad facilis cum similique qui sunt|https://via.placeholder.com/600/92c952|{&quot;</span><span style="color:#a3be8c;">albumId</span><span>&quot;...&quot;
</span></code></pre>
<p>The message is clear: we are trying to insert values into the database without specifying the values for the <code>created</code> and <code>updated</code> columns, thereby violating the <code>not-null</code> constraint. However, if we look at the code in our <code>Photo</code> model, we see that we have added the two parameters <code>auto_now=True</code> and <code>auto_now_add=True</code>. Why is this happening?</p>
<pre data-lang="py" style="background-color:#2b303b;color:#c0c5ce;" class="language-py "><code class="language-py" data-lang="py"><span style="color:#b48ead;">from </span><span>django.db </span><span style="color:#b48ead;">import </span><span>models
</span><span>
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Photo</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">models.Model</span><span style="color:#eff1f5;">):
</span><span>	</span><span style="color:#65737e;"># //code
</span><span>    created = models.</span><span style="color:#bf616a;">DateTimeField</span><span>(</span><span style="color:#bf616a;">auto_now_add</span><span>=</span><span style="color:#d08770;">True</span><span>) </span><span style="color:#65737e;"># here
</span><span>    updated = models.</span><span style="color:#bf616a;">DateTimeField</span><span>(</span><span style="color:#bf616a;">auto_now</span><span>=</span><span style="color:#d08770;">True</span><span>) </span><span style="color:#65737e;"># here
</span><span>
</span><span>	</span><span style="color:#65737e;"># //code
</span></code></pre>
<blockquote>
<p>The field is only automatically updated when calling <code>Model.save()</code>. The field isn’t updated when making updates to other fields in other ways such as <code>QuerySet.update()</code>, though you can specify a custom value for the field in an update like that.</p>
</blockquote>
<p>When you call Model.save(), Django runs extra Python logic, like automatically updating auto_now or auto_now_add fields, running model signals <code>pre_save</code>, <code>post_save</code>, and handling field defaults. However, when you use <code>QuerySet.update()</code>, Django bypasses all of that and sends a direct <code>SQL UPDATE</code> to the database without calling <code>.save()</code> on each object. Because of that, the database itself doesn’t know about Django’s automatic updates it just updates the specified columns. So the rule is: the auto-update behavior is controlled by Django’s model system in Python, not by the database engine.</p>
<p>We can verify this by looking at the SQL code that was generated by the migration.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python</span><span> manage.py sqlmigrate photos 0001  
</span></code></pre>
<pre data-lang="sql" style="background-color:#2b303b;color:#c0c5ce;" class="language-sql "><code class="language-sql" data-lang="sql"><span style="color:#b48ead;">BEGIN</span><span>;
</span><span style="color:#65737e;">--
</span><span style="color:#65737e;">-- Create model Photo
</span><span style="color:#65737e;">--
</span><span style="color:#b48ead;">CREATE TABLE </span><span>&quot;</span><span style="color:#8fa1b3;">photos</span><span>&quot; (
</span><span>	&quot;</span><span style="color:#a3be8c;">id</span><span>&quot; </span><span style="color:#b48ead;">bigint </span><span>NOT </span><span style="color:#d08770;">NULL </span><span style="color:#b48ead;">PRIMARY KEY</span><span> GENERATED BY </span><span style="color:#b48ead;">DEFAULT </span><span>AS IDENTITY, 
</span><span>	&quot;</span><span style="color:#a3be8c;">title</span><span>&quot; </span><span style="color:#b48ead;">varchar</span><span>(</span><span style="color:#d08770;">255</span><span>) NOT </span><span style="color:#d08770;">NULL</span><span>, 
</span><span>	&quot;</span><span style="color:#a3be8c;">url</span><span>&quot; </span><span style="color:#b48ead;">varchar</span><span>(</span><span style="color:#d08770;">255</span><span>) NOT </span><span style="color:#d08770;">NULL</span><span>, 
</span><span>	&quot;</span><span style="color:#a3be8c;">raw_data</span><span>&quot; jsonb NOT </span><span style="color:#d08770;">NULL</span><span>, 
</span><span>	&quot;</span><span style="color:#a3be8c;">created</span><span>&quot; </span><span style="color:#b48ead;">timestamp with time zone </span><span>NOT </span><span style="color:#d08770;">NULL</span><span>, 
</span><span>	&quot;</span><span style="color:#a3be8c;">updated</span><span>&quot; </span><span style="color:#b48ead;">timestamp with time zone </span><span>NOT </span><span style="color:#d08770;">NULL
</span><span>	);
</span><span style="color:#b48ead;">COMMIT</span><span>;
</span></code></pre>
<p>As you can see, the two columns <code>created</code> and <code>updated</code> have the <code>NOT NULL</code> constraint, but there is nothing to indicate that we want the database to fill them with a default value.</p>
<p>To solve this problem, we have two solutions:</p>
<ol>
<li>Explicitly set these two values in our Python code.</li>
<li>Change the SQL code generated by my migration to automatically add these two values to the database.</li>
</ol>
<h4 id="1-explicitly-set-values-in-python-code"><a class="zola-anchor" href="#1-explicitly-set-values-in-python-code" aria-label="Anchor link for: 1-explicitly-set-values-in-python-code">1- Explicitly set values in Python code.</a></h4>
<p>In the Django documentation we can see this in the section of <a href="https://docs.djangoproject.com/en/5.2/ref/models/fields/#datefield">DateField</a></p>
<blockquote>
<strong>DateField.auto_now_add</strong>
<p>Automatically set the field to now when the object is first created. Useful for creation of timestamps. Note that the current date is always used; it’s not just a default value that you can override. So even if you set a value for this field when creating the object, it will be ignored. If you want to be able to modify this field, set the following instead of <code>auto_now_add=True</code>:</p>
<ul>
<li>For DateField: <code>default=date.today</code> - from <code>datetime.date.today()</code></li>
<li>For DateTimeField: <code>default=timezone.now</code> - from <code>django.utils.timezone.now()</code></li>
</ul>
</blockquote>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>io
</span><span style="color:#b48ead;">import </span><span>json
</span><span style="color:#b48ead;">from </span><span>django.db </span><span style="color:#b48ead;">import </span><span>connection
</span><span style="color:#b48ead;">from </span><span>django.utils </span><span style="color:#b48ead;">import </span><span>timezone  </span><span style="color:#65737e;"># new
</span><span style="color:#b48ead;">from </span><span>typing </span><span style="color:#b48ead;">import </span><span>Iterator, Dict, Any
</span><span>
</span><span>@</span><span style="color:#bf616a;">profile
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">insert_string_io</span><span>(</span><span style="color:#bf616a;">photos</span><span>: Iterator[Dict[str, Any]]):
</span><span>    columns = (&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">url</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">raw_data</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">created</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">updated</span><span>&quot;)
</span><span>    csv_file_like_object = io.</span><span style="color:#bf616a;">StringIO</span><span>()
</span><span>    now = timezone.</span><span style="color:#bf616a;">now</span><span>().</span><span style="color:#bf616a;">isoformat</span><span>() </span><span style="color:#65737e;"># new
</span><span>    </span><span style="color:#b48ead;">for </span><span>photo </span><span style="color:#b48ead;">in </span><span>photos:
</span><span>        csv_file_like_object.</span><span style="color:#bf616a;">write</span><span>(
</span><span>            &quot;</span><span style="color:#a3be8c;">|</span><span>&quot;.</span><span style="color:#bf616a;">join</span><span>((photo[&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;], photo[&quot;</span><span style="color:#a3be8c;">url</span><span>&quot;], json.</span><span style="color:#bf616a;">dumps</span><span>(photo), now, now)) + &quot;</span><span style="color:#96b5b4;">\n</span><span>&quot;
</span><span>        )
</span><span>    csv_file_like_object.</span><span style="color:#bf616a;">seek</span><span>(</span><span style="color:#d08770;">0</span><span>)
</span><span>    </span><span style="color:#b48ead;">with </span><span>connection.</span><span style="color:#bf616a;">cursor</span><span>() </span><span style="color:#b48ead;">as </span><span>cursor:
</span><span>        cursor.</span><span style="color:#bf616a;">copy_from</span><span>(csv_file_like_object, &quot;</span><span style="color:#a3be8c;">photos</span><span>&quot;, </span><span style="color:#bf616a;">sep</span><span>=&quot;</span><span style="color:#a3be8c;">|</span><span>&quot;, </span><span style="color:#bf616a;">columns</span><span>=columns)
</span></code></pre>
<p>Now run the script again</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python</span><span> manage.py load_data
</span><span>
</span><span style="color:#bf616a;">insert_string_io
</span><span style="color:#bf616a;">Time</span><span>   9.8585s
</span><span style="color:#bf616a;">Memory</span><span> 793.827 MiB (peak)
</span></code></pre>
<p>So, we have a slight improvement in execution time compared to the <code>bulk_create</code> version, but we are consuming more memory. The <code>insert_string_io</code> function was executed, it took approximately <strong>10</strong> seconds to complete and used about <strong>793.83</strong> megabytes of memory at its highest point during execution. Which suggests that the function was handling a large amount of data in memory (buffering a big CSV) before writing or inserting it.</p>
<h4 id="2-change-the-sql-code-generated-by-my-migration"><a class="zola-anchor" href="#2-change-the-sql-code-generated-by-my-migration" aria-label="Anchor link for: 2-change-the-sql-code-generated-by-my-migration">2- Change the SQL code generated by my migration</a></h4>
<p>You can safely add the SQL changes (like adding DEFAULT CURRENT_TIMESTAMP or creating an update trigger) in a separate migration file such as 0002_auto_add_timestamps.py.
That’s actually the <strong>best practice</strong>, because you keep Django’s auto-generated schema (0001_initial.py) clean and version-controlled by Django, while your custom SQL lives in a clearly separate migration.</p>
<p>Create a <code>0002_auto_add_timestamps.py</code>file unser the <code>photos/migrations</code> folder and modify it as follwing:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>django.db </span><span style="color:#b48ead;">import </span><span>migrations
</span><span>
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Migration</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">migrations.Migration</span><span style="color:#eff1f5;">):
</span><span>
</span><span>    dependencies = [
</span><span>        (&quot;</span><span style="color:#a3be8c;">photos</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">0001_initial</span><span>&quot;),  </span><span style="color:#65737e;"># depends on your first migration
</span><span>    ]
</span><span>
</span><span>    operations = [
</span><span>        migrations.</span><span style="color:#bf616a;">RunSQL</span><span>(
</span><span>            </span><span style="color:#bf616a;">sql</span><span>=&quot;&quot;&quot;
</span><span style="color:#a3be8c;">            </span><span style="color:#b48ead;">ALTER TABLE </span><span style="color:#a3be8c;">photos
</span><span style="color:#a3be8c;">            ALTER COLUMN created </span><span style="color:#b48ead;">SET DEFAULT </span><span style="color:#96b5b4;">CURRENT_TIMESTAMP</span><span style="color:#a3be8c;">,
</span><span style="color:#a3be8c;">            ALTER COLUMN updated </span><span style="color:#b48ead;">SET DEFAULT </span><span style="color:#96b5b4;">CURRENT_TIMESTAMP</span><span style="color:#a3be8c;">;
</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">            </span><span style="color:#65737e;">-- Function to auto-update the &quot;updated&quot; column on UPDATE
</span><span style="color:#a3be8c;">            </span><span style="color:#b48ead;">CREATE OR REPLACE FUNCTION </span><span style="color:#8fa1b3;">update_updated_column</span><span style="color:#a3be8c;">()
</span><span style="color:#a3be8c;">            RETURNS TRIGGER </span><span>AS</span><span style="color:#a3be8c;"> $$
</span><span style="color:#a3be8c;">            </span><span style="color:#b48ead;">BEGIN
</span><span style="color:#a3be8c;">                </span><span style="color:#d08770;">NEW</span><span style="color:#a3be8c;">.</span><span style="color:#d08770;">updated </span><span>=</span><span style="color:#a3be8c;"> NOW();
</span><span style="color:#a3be8c;">                RETURN NEW;
</span><span style="color:#a3be8c;">            </span><span style="color:#b48ead;">END</span><span style="color:#a3be8c;">;
</span><span style="color:#a3be8c;">            $$ LANGUAGE plpgsql;
</span><span style="color:#a3be8c;">
</span><span style="color:#a3be8c;">            </span><span style="color:#65737e;">-- Trigger that calls the function on every update
</span><span style="color:#a3be8c;">            </span><span style="color:#b48ead;">DROP TRIGGER</span><span style="color:#a3be8c;"> IF </span><span>EXISTS</span><span style="color:#a3be8c;"> set_timestamp ON photos;
</span><span style="color:#a3be8c;">            </span><span style="color:#b48ead;">CREATE TRIGGER </span><span style="color:#8fa1b3;">set_timestamp
</span><span style="color:#a3be8c;">            BEFORE </span><span style="color:#b48ead;">UPDATE</span><span style="color:#a3be8c;"> ON photos
</span><span style="color:#a3be8c;">            FOR EACH ROW
</span><span style="color:#a3be8c;">            EXECUTE FUNCTION update_updated_column();
</span><span style="color:#a3be8c;">            </span><span>&quot;&quot;&quot;,
</span><span>            </span><span style="color:#bf616a;">reverse_sql</span><span>=&quot;&quot;&quot;
</span><span style="color:#a3be8c;">            DROP TRIGGER IF EXISTS set_timestamp ON photos;
</span><span style="color:#a3be8c;">            DROP FUNCTION IF EXISTS update_updated_column();
</span><span style="color:#a3be8c;">            ALTER TABLE photos
</span><span style="color:#a3be8c;">            ALTER COLUMN created DROP DEFAULT,
</span><span style="color:#a3be8c;">            ALTER COLUMN updated DROP DEFAULT;
</span><span style="color:#a3be8c;">            </span><span>&quot;&quot;&quot;,
</span><span>        ),
</span><span>    ]
</span></code></pre>
<p>Now run the migration command</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python</span><span> manage.py migrate
</span></code></pre>
<p>Change the code in <code>load_data.py</code> file</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>io
</span><span style="color:#b48ead;">import </span><span>json
</span><span style="color:#b48ead;">from </span><span>django.db </span><span style="color:#b48ead;">import </span><span>connection
</span><span style="color:#b48ead;">from </span><span>typing </span><span style="color:#b48ead;">import </span><span>Iterator, Dict, Any
</span><span>
</span><span>@</span><span style="color:#bf616a;">profile
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">insert_string_io</span><span>(</span><span style="color:#bf616a;">photos</span><span>: Iterator[Dict[str, Any]]):
</span><span>    columns = (&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">url</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">raw_data</span><span>&quot;)
</span><span>    csv_file_like_object = io.</span><span style="color:#bf616a;">StringIO</span><span>()
</span><span>    now = timezone.</span><span style="color:#bf616a;">now</span><span>().</span><span style="color:#bf616a;">isoformat</span><span>() </span><span style="color:#65737e;"># new
</span><span>    </span><span style="color:#b48ead;">for </span><span>photo </span><span style="color:#b48ead;">in </span><span>photos:
</span><span>        csv_file_like_object.</span><span style="color:#bf616a;">write</span><span>(
</span><span>            &quot;</span><span style="color:#a3be8c;">|</span><span>&quot;.</span><span style="color:#bf616a;">join</span><span>((photo[&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;], photo[&quot;</span><span style="color:#a3be8c;">url</span><span>&quot;], json.</span><span style="color:#bf616a;">dumps</span><span>(photo))) + &quot;</span><span style="color:#96b5b4;">\n</span><span>&quot;
</span><span>        )
</span><span>    csv_file_like_object.</span><span style="color:#bf616a;">seek</span><span>(</span><span style="color:#d08770;">0</span><span>)
</span><span>    </span><span style="color:#b48ead;">with </span><span>connection.</span><span style="color:#bf616a;">cursor</span><span>() </span><span style="color:#b48ead;">as </span><span>cursor:
</span><span>        cursor.</span><span style="color:#bf616a;">copy_from</span><span>(csv_file_like_object, &quot;</span><span style="color:#a3be8c;">photos</span><span>&quot;, </span><span style="color:#bf616a;">sep</span><span>=&quot;</span><span style="color:#a3be8c;">|</span><span>&quot;, </span><span style="color:#bf616a;">columns</span><span>=columns)
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python</span><span> manage.py load_data
</span><span>
</span><span style="color:#bf616a;">insert_string_io
</span><span style="color:#bf616a;">Time</span><span>   9.4409s
</span><span style="color:#bf616a;">Memory</span><span> 636.471 MiB (peak)
</span><span style="color:#bf616a;">Successfully</span><span> Loaded Data to Photos
</span></code></pre>
<p>As you can see, the execution time has not changed, but we are using slightly less memory.</p>
<h3 id="copy-data-from-a-string-iterator"><a class="zola-anchor" href="#copy-data-from-a-string-iterator" aria-label="Anchor link for: copy-data-from-a-string-iterator">Copy Data From a String Iterator</a></h3>
<p>One of the key limitations of using <code>COPY</code> with <code>StringIO</code> is that the entire dataset is first built and stored in memory, which can quickly become inefficient or even unmanageable for large imports. A more scalable approach is to create a streaming, <code>file-like</code> buffer that acts as an intermediary between the remote data source and the PostgreSQL <code>COPY</code> command. Instead of loading all data at once, this buffer would consume JSON records incrementally through an iterator, performing any necessary cleaning, validation, or transformation on each record before yielding a properly formatted CSV row. This streaming design dramatically reduces memory usage, improves performance on large datasets, and allows continuous ingestion of data without waiting for the entire file to be generated upfront.</p>
<div align="center">
<img src="/copy-diagram.svg" width="100%"/>
</div>
<p>You can refer to this <a href="https://stackoverflow.com/questions/12593576/adapt-an-iterator-to-behave-like-a-file-like-object-in-python/12604375#12604375">stack overflow answer</a> to created an object that feeds off an iterator, and provides a file-like interface:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>typing </span><span style="color:#b48ead;">import </span><span>Iterator, Optional
</span><span style="color:#b48ead;">import </span><span>io
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">StringIteratorIO</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">io.TextIOBase</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#96b5b4;">__init__</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">iter</span><span>: Iterator[str]):
</span><span>        </span><span style="color:#bf616a;">self</span><span>._iter = </span><span style="color:#96b5b4;">iter
</span><span>        </span><span style="color:#bf616a;">self</span><span>._buff = &#39;&#39;
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">readable</span><span>(</span><span style="color:#bf616a;">self</span><span>) -&gt; bool:
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">True
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">_read1</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">n</span><span>: Optional[int] = </span><span style="color:#d08770;">None</span><span>) -&gt; str:
</span><span>        </span><span style="color:#b48ead;">while </span><span>not </span><span style="color:#bf616a;">self</span><span>._buff:
</span><span>            </span><span style="color:#b48ead;">try</span><span>:
</span><span>                </span><span style="color:#bf616a;">self</span><span>._buff = </span><span style="color:#96b5b4;">next</span><span>(</span><span style="color:#bf616a;">self</span><span>._iter)
</span><span>            </span><span style="color:#b48ead;">except </span><span>StopIteration:
</span><span>                </span><span style="color:#b48ead;">break
</span><span>        ret = </span><span style="color:#bf616a;">self</span><span>._buff[:n]
</span><span>        </span><span style="color:#bf616a;">self</span><span>._buff = </span><span style="color:#bf616a;">self</span><span>._buff[</span><span style="color:#96b5b4;">len</span><span>(ret):]
</span><span>        </span><span style="color:#b48ead;">return </span><span>ret
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">read</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">n</span><span>: Optional[int] = </span><span style="color:#d08770;">None</span><span>) -&gt; str:
</span><span>        line = []
</span><span>        </span><span style="color:#b48ead;">if </span><span>n is </span><span style="color:#d08770;">None </span><span>or n &lt; </span><span style="color:#d08770;">0</span><span>:
</span><span>            </span><span style="color:#b48ead;">while </span><span style="color:#d08770;">True</span><span>:
</span><span>                m = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">_read1</span><span>()
</span><span>                </span><span style="color:#b48ead;">if </span><span>not m:
</span><span>                    </span><span style="color:#b48ead;">break
</span><span>                line.</span><span style="color:#bf616a;">append</span><span>(m)
</span><span>        </span><span style="color:#b48ead;">else</span><span>:
</span><span>            </span><span style="color:#b48ead;">while </span><span>n &gt; </span><span style="color:#d08770;">0</span><span>:
</span><span>                m = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">_read1</span><span>(n)
</span><span>                </span><span style="color:#b48ead;">if </span><span>not m:
</span><span>                    </span><span style="color:#b48ead;">break
</span><span>                n -= </span><span style="color:#96b5b4;">len</span><span>(m)
</span><span>                line.</span><span style="color:#bf616a;">append</span><span>(m)
</span><span>        </span><span style="color:#b48ead;">return </span><span>&#39;&#39;.</span><span style="color:#bf616a;">join</span><span>(line)
</span></code></pre>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>io
</span><span style="color:#b48ead;">import </span><span>json
</span><span style="color:#b48ead;">from </span><span>django.db </span><span style="color:#b48ead;">import </span><span>connection
</span><span style="color:#b48ead;">from </span><span>typing </span><span style="color:#b48ead;">import </span><span>Iterator, Dict, Any
</span><span>@</span><span style="color:#bf616a;">profile
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">insert_buffer_string_io</span><span>(</span><span style="color:#bf616a;">photos</span><span>: Iterator[Dict[str, Any]]):
</span><span>    columns = (&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">url</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">raw_data</span><span>&quot;)
</span><span>    csv_file_like_object = </span><span style="color:#bf616a;">StringIteratorIO</span><span>(
</span><span>        (&quot;</span><span style="color:#a3be8c;">|</span><span>&quot;.</span><span style="color:#bf616a;">join</span><span>((photo[&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;], photo[&quot;</span><span style="color:#a3be8c;">url</span><span>&quot;], json.</span><span style="color:#bf616a;">dumps</span><span>(photo)))) + &quot;</span><span style="color:#96b5b4;">\n</span><span>&quot;
</span><span>        </span><span style="color:#b48ead;">for </span><span>photo </span><span style="color:#b48ead;">in </span><span>photos
</span><span>    )
</span><span>    </span><span style="color:#b48ead;">with </span><span>connection.</span><span style="color:#bf616a;">cursor</span><span>() </span><span style="color:#b48ead;">as </span><span>cursor:
</span><span>        cursor.</span><span style="color:#bf616a;">copy_from</span><span>(csv_file_like_object, &quot;</span><span style="color:#a3be8c;">photos</span><span>&quot;, </span><span style="color:#bf616a;">sep</span><span>=&quot;</span><span style="color:#a3be8c;">|</span><span>&quot;, </span><span style="color:#bf616a;">columns</span><span>=columns)
</span></code></pre>
<blockquote>
<p>Here we didn't add <code>created</code> and <code>updated</code> to the comumns neither the values beacuse we had made a SQL migration before, so if you stock with the pythonic way the function should look like this:</p>
</blockquote>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">import </span><span>io
</span><span style="color:#b48ead;">import </span><span>json
</span><span style="color:#b48ead;">from </span><span>django.db </span><span style="color:#b48ead;">import </span><span>connection
</span><span style="color:#b48ead;">from </span><span>django.utils </span><span style="color:#b48ead;">import </span><span>timezone  </span><span style="color:#65737e;"># new
</span><span style="color:#b48ead;">from </span><span>typing </span><span style="color:#b48ead;">import </span><span>Iterator, Dict, Any
</span><span>
</span><span>@</span><span style="color:#bf616a;">profile
</span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">insert_buffer_string_io</span><span>(</span><span style="color:#bf616a;">photos</span><span>: Iterator[Dict[str, Any]]):
</span><span>    columns = (&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">url</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">raw_data</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">created</span><span>&quot;,&quot;</span><span style="color:#a3be8c;">updated</span><span>&quot;)
</span><span>	now = timezone.</span><span style="color:#bf616a;">now</span><span>().</span><span style="color:#bf616a;">isoformat</span><span>() </span><span style="color:#65737e;"># new
</span><span>    csv_file_like_object = </span><span style="color:#bf616a;">StringIteratorIO</span><span>(
</span><span>        (&quot;</span><span style="color:#a3be8c;">|</span><span>&quot;.</span><span style="color:#bf616a;">join</span><span>((photo[&quot;</span><span style="color:#a3be8c;">title</span><span>&quot;], photo[&quot;</span><span style="color:#a3be8c;">url</span><span>&quot;], json.</span><span style="color:#bf616a;">dumps</span><span>(photo), now, now))) + &quot;</span><span style="color:#96b5b4;">\n</span><span>&quot;
</span><span>        </span><span style="color:#b48ead;">for </span><span>photo </span><span style="color:#b48ead;">in </span><span>photos
</span><span>    )
</span><span>    </span><span style="color:#b48ead;">with </span><span>connection.</span><span style="color:#bf616a;">cursor</span><span>() </span><span style="color:#b48ead;">as </span><span>cursor:
</span><span>        cursor.</span><span style="color:#bf616a;">copy_from</span><span>(csv_file_like_object, &quot;</span><span style="color:#a3be8c;">photos</span><span>&quot;, </span><span style="color:#bf616a;">sep</span><span>=&quot;</span><span style="color:#a3be8c;">|</span><span>&quot;, </span><span style="color:#bf616a;">columns</span><span>=columns)
</span></code></pre>
<p>Change the <code>load_data.py</code>command</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Command</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">BaseCommand</span><span style="color:#eff1f5;">):
</span><span>    </span><span style="color:#96b5b4;">help </span><span>= &quot;</span><span style="color:#a3be8c;">Load Data from External API</span><span>&quot;
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">handle</span><span>(</span><span style="color:#bf616a;">self</span><span>, *</span><span style="color:#bf616a;">args</span><span>, **</span><span style="color:#bf616a;">options</span><span>):
</span><span>        </span><span style="color:#65737e;"># insert_django_bulk_create(photos=photos)
</span><span>        </span><span style="color:#65737e;">#insert_string_io(photos=photos)
</span><span>		</span><span style="color:#bf616a;">insert_buffer_string_io</span><span>(</span><span style="color:#bf616a;">photos</span><span>=photos)
</span><span>        </span><span style="color:#bf616a;">self</span><span>.stdout.</span><span style="color:#bf616a;">write</span><span>(</span><span style="color:#bf616a;">self</span><span>.style.</span><span style="color:#bf616a;">SUCCESS</span><span>(&quot;</span><span style="color:#a3be8c;">Successful</span><span style="background-color:#bf616a;color:#2b303b;">
</span></code></pre>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">python</span><span> manage.py load_data   
</span><span>
</span><span style="color:#bf616a;">insert_buffer_string_io
</span><span style="color:#bf616a;">Time</span><span>   8.6109s
</span><span style="color:#bf616a;">Memory</span><span> 0.022 MiB (peak)
</span></code></pre>
<p>The insert_buffer_string_io operation completed in <strong>8.6109</strong> seconds and reached a peak memory usage of only <strong>0.022</strong> MiB. This means the process took a moderate amount of time to execute but was extremely memory-efficient. The low memory footprint suggests that data was handled incrementally—likely using a streaming or buffered approach—rather than being fully loaded into memory at once.</p>
<pre data-lang="bash" style="background-color:#2b303b;color:#c0c5ce;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#bf616a;">psql</span><span> (18.0 (Debian 18.0-1.pgdg13+3))
</span><span style="color:#bf616a;">Type </span><span>&quot;</span><span style="color:#a3be8c;">help</span><span>&quot; for help.
</span><span>
</span><span style="color:#bf616a;">django</span><span>=</span><span style="color:#a3be8c;"># </span><span style="color:#bf616a;">select</span><span> count(id) </span><span style="color:#bf616a;">from</span><span> photos;
</span><span> </span><span style="color:#bf616a;">count  
</span><span style="color:#bf616a;">--------
</span><span> </span><span style="color:#bf616a;">500000
</span><span>(</span><span style="color:#bf616a;">1</span><span> row)
</span></code></pre>
<h3 id="github-repo"><a class="zola-anchor" href="#github-repo" aria-label="Anchor link for: github-repo">Github Repo</a></h3>
<p><a href="https://github.com/malnossi/djangopostgrescopy">Source Code</a></p>
<h3 id="conclusion"><a class="zola-anchor" href="#conclusion" aria-label="Anchor link for: conclusion">Conclusion</a></h3>
<p>You might wonder which approach to choose and, as always, the honest answer is "it depends". The key takeaway is to stay aware of the potential side effects that could impact your project.</p>
<p>Here are a few important considerations:</p>
<ul>
<li>If you’re working with multiple databases or complex routing, ensure that your Django model is connected to the correct database.</li>
<li>Copy operations do not trigger Django model signals such as <code>pre_save</code> or <code>post_save</code>.</li>
<li>Despite these caveats, using <code>copy_from</code> methods offers a substantial performance boost over <code>bulk_create</code>, which itself is already faster than inserting records one by one.</li>
</ul>
<p><strong>This article was inspired by <a href="https://hakibenita.com/fast-load-data-python-postgresql">Haki Benita's article</a>, so thank you to him for his wonderful work.</strong></p>
</section>
  <hr />
  <!-- Post Taxonomies -->
<footer class="mt-12 flex flex-col" tabindex="-1" accesskey="_">
  <div class="mb-2 flex flex-wrap">
    <span class="block-bg mr-1.5 mb-1.5 rounded-lg px-5 py-1.5">Tags</span>
    
    <a
      class="block-bg block-hover mr-1.5 mb-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://malnossi.github.io/tags/django/">Django</a>
    
    <a
      class="block-bg block-hover mr-1.5 mb-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://malnossi.github.io/tags/postgresql/">PostgreSQL</a>
    
    <a
      class="block-bg block-hover mr-1.5 mb-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://malnossi.github.io/tags/data/">Data</a>
    
  </div>
</footer>

  <!-- Post Nav -->
<nav class="block-bg mt-12 flex flex-wrap rounded-lg text-lg">
  <a
    class="block-hover-mask ml-auto flex min-w-[50%] grow items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline"
    href="https://malnossi.github.io/blog/streaming-videos-with-golang/" accesskey="."
    ><span>Stream videos with Go and Http</span><span class="ml-1.5">&#8250;</span></a>
</nav>

  <!-- Begin Page End inject -->
  
  <!-- End Page End inject -->
</article>

  </main>
  <!-- Footer -->
<footer class="mx-auto flex lg:mt-5 max-w-3xl flex-wrap items-center px-4 py-3 text-sm opacity-60">
  <div class="mr-auto basis-full lg:basis-1/2">
  © <time datetime="2025">2025</time> Mohamed Nossirat
  </div>
  <div class="flex basis-full lg:basis-1/2 lg:justify-end">
    <span class="mr-6 lg:ml-6">
      <a class="link" href="https://www.getzola.org/" target="_blank">Powered by Zola</a>
    </span>
    <a class="link" href="https://www.getzola.org/themes/linkita/" target="_blank">&#9998; Linkita</a>
  </div>
  <!-- Begin Footer inject -->
  
  <!-- End Footer inject -->
</footer>

  

  <!-- Begin Body End inject -->
  

  <script src="https:&#x2F;&#x2F;cdnapp.websitepolicies.net&#x2F;widgets&#x2F;cookies&#x2F;mzad7vzz.js" defer></script>



<script>
  // If your cookie widget exposes callbacks, flip GA consent when accepted.
  // Adjust to your provider’s API.
  window.addEventListener('CookieConsentAccepted', function () {
    if (window.gtag) {
      gtag('consent', 'update', { analytics_storage: 'granted' });
    }
  });
</script>
  <!-- End Body End inject -->
</body>

</html>
