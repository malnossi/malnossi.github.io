<!doctype html>
<html class="not-ready lg:text-base overflow-y-scroll scroll-pt-14 scheme-light dark:scheme-dark" lang="en">

<head prefix="og: https://ogp.me/ns# article: https://ogp.me/ns/article#">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="generator" content="Zola v0.21.0" />
  <title>Django Rest Framework rich related serializer</title>
  <meta property="og:title" content="Django Rest Framework rich related serializer" />
  <meta name="description" content="Readable API responses shouldnâ€™t compromise write operations. This article introduces a custom serializer field derived from DRFâ€™s PrimaryKeyRelatedField that returns nested objects for reads while acâ€¦" />
  <meta property="og:description" content="Readable API responses shouldnâ€™t compromise write operations. This article introduces a custom serializer field derived from DRFâ€™s PrimaryKeyRelatedField that returns nested objects for reads while accepting primary keys for writes, yielding cleaner responses without sacrificing flexibility." />
  <meta property="og:url" content="https://malnossi.github.io/blog/drf-primarylink-serializer/" />
  <link rel="canonical" href="https://malnossi.github.io/blog/drf-primarylink-serializer/" />
  <meta property="og:type" content="article" />
  <meta property="article:published_time" content="2024-08-23T00:00:00+00:00" />
  <meta property="article:tag" content="Django" />
  <meta property="article:tag" content="DRF" />
  <meta property="article:tag" content="Python" />
  <meta property="og:image" content="https://malnossi.github.io/pro_django.avif" />
  <meta property="og:image:alt" content="" />
  <meta property="og:image:width" content="3474" />
  <meta property="og:image:height" content="2606" />
  <meta property="og:image:type" content="image/avif" />
  <link rel="alternate" type="application/atom+xml" href="https://malnossi.github.io/atom.xml" title="Atom" />
  <!-- Begin Head inject -->
  
  <!-- End Head inject -->
  <link rel="stylesheet" href="https://malnossi.github.io/main.min.css?h=a74dd0c65eed2d85f55f" />
  <link rel="stylesheet" href="https://malnossi.github.io/icons.css?h=7dd5ab449fa840fc01e2" />
  <style>:root{--bg: #f4f4f5; --header: #e4e4e7;} :root.dark{--bg: #18181b; --header: #27272a;}</style>
  <meta name="theme-color" data-light="#e4e4e7" data-dark="#27272a" content="#e4e4e7" />
  <link rel="icon" type="image/x-icon" href="https://malnossi.github.io/favicon.ico" />
  <link rel="apple-touch-icon" type="image/png" href="https://malnossi.github.io/apple-touch-icon.png?h=58bee300054c5308feb3" />
  <link rel="icon" type="image/png" href="https://malnossi.github.io/android-icon.png?h=8d80ec95446bd2c36826" />
  <script src="https://malnossi.github.io/js/zola-theme.min.js?h=26975b146d48e6ff41af"></script>
  <!-- Begin Head End inject -->
  
<meta name="author" content="Mohamed Nossirat">
<meta property="article:author" content="Mohamed Nossirat">
<meta name="twitter:creator" content="Mohamed Nossirat">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-8LBRDGLXJV"></script>
<script>
  // (Optional) default deny until consent tool flips it to granted
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('consent', 'default', { analytics_storage: 'denied' });
  gtag('js', new Date());
  gtag('config', 'G-8LBRDGLXJV', {
    anonymize_ip: true
  });
</script>


  <!-- End Head End inject -->
</head>

<body class="text-black duration-100 ease-out dark:text-white">
  <!-- Header -->
<header class="header fixed top-0 z-40 mx-auto min-h-13 w-full">
  <div class="mx-auto w-full max-w-4xl p-2.5 lg:flex lg:justify-between">
    <div class="flex justify-between">
      <div class="flex items-center min-h-8 overflow-hidden">
        <button type="button" title="Go to home page [Alt + !]" accesskey="!"
          onclick="window.location.href='https://malnossi.github.io/';"
          class="btn-home h-6 w-6 shrink-0 cursor-pointer text-[0px]
            bg-center bg-no-repeat bg-cover [background-image:var(--icons-home,url(icons/home.svg))] dark:invert"
        ></button>
        <button type="button" title="Switch color scheme [Alt + $]" accesskey="$"
          onclick="window.zolaTheme.color.toggle();"
          class="btn-dark ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0px]
            bg-center bg-no-repeat bg-cover [background-image:var(--icons-btn-dark,url(icons/btn-dark.svg))]
            dark:[background-image:var(--icons-btn-light,url(icons/btn-light.svg))] dark:invert"
        ></button>
        <button type="button" title="Open search [Alt + /]" accesskey="/"
          onclick="window.zolaTheme.search.toggle();"
          class="btn-search ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0px]
            bg-center bg-no-repeat bg-cover [background-image:var(--icons-search,url(icons/search.svg))] dark:invert"
        ></button>
      </div>
      <div title="Toggle menu [Alt + `+`]" role="button" accesskey="+" tabindex="0"
        class="btn-menu relative z-50 flex h-8 w-8 shrink-0 cursor-pointer select-none flex-col items-center justify-center gap-2.5 lg:hidden"
        onclick="window.zolaTheme.menu.toggleHeader();"
        onkeydown="(event.keyCode == 13 || event.keyCode == 32) ? event.preventDefault() || window.zolaTheme.menu.toggleHeader() : true;"
      ></div>
    </div>
    <nav class="flex w-full items-center lg:w-auto">
      <menu
        class="nav-wrapper flex w-full flex-col py-2 lg:w-auto lg:flex-row lg:self-center lg:py-0">
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://malnossi.github.io/blog/"
          >Blog</a>
        </li>
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://malnossi.github.io/tags/"
          >Tags</a>
        </li>
      </menu>
      <!-- Begin Header Nav inject -->
      
      <!-- End Header Nav inject -->
    </nav>
  </div>
</header>

  <!-- Begin Body Start inject -->
  
  <!-- End Body Start inject -->
  <main class="prose prose-neutral dark:prose-invert prose-pre:rounded-lg prose-img:rounded-lg
    relative mx-auto min-h-[calc(100vh-4rem)] max-w-3xl px-4 pt-28 lg:pt-32 pb-12 wrap-break-word">
      <!-- Search -->
<div id="linkita-search-wrapper" class="hidden">
  <ul id="linkita-search-results"></ul>
</div>
<script>window.zolaTheme.search.init({ scripts: ["https://malnossi.github.io/elasticlunr.min.js", "https://malnossi.github.io/search_index.en.js"], arg: { w: "#linkita-search-wrapper", r: "#linkita-search-results" } });</script>

    
<article>
  <!-- Begin Page Start inject -->
  
  <!-- End Page Start inject -->

  <header class="mb-16">
    <h1 class="my-0! pb-2.5">Django Rest Framework rich related serializer</h1>
    <!-- Page Info -->
<div class="text-sm antialiased opacity-80"><time
      datetime="2024-08-23T00:00:00+00:00">2024-08-23</time><span
        class="middot"></span><time
    datetime="PT0H4M0S">4&nbsp;min</time><span
      class="middot"></span><span>Mohamed Nossirat</span>
</div>

  </header>
  <figure class="mt-0 mb-12">
    <img
      class="h-auto w-full rounded-lg"
      src="https://malnossi.github.io/pro_django.avif"
      width="3474"
      height="2606"
    />
  </figure>
  <!-- TOC -->
<nav class="block-bg prose-a:secondary-link mb-12 rounded-lg p-2 text-lg">
  <details>
    <summary class="select-none py-0.5 lg:py-1 pl-3.5" title="[Alt + =]" accesskey="=">
      <span class="cursor-pointer ml-0.5">Table of Contents</span>
    </summary>
    <ul class="ps-8">
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/drf-primarylink-serializer/#introduction">Introduction</a>
        <ul>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/drf-primarylink-serializer/#example">Example</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/drf-primarylink-serializer/#what-we-can-get">What we can get</a>
          </li>
        </ul>
      </li>
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/drf-primarylink-serializer/#solutions">Solutions</a>
        <ul>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/drf-primarylink-serializer/#1-use-nested-serializers">1- Use nested serializers</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/drf-primarylink-serializer/#2-use-two-serializers-one-to-read-data-and-the-other-to-write-it">2- Use two serializers one to read data and the other to write it</a>
          </li>
          <li class="ps-0.5">
            <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/drf-primarylink-serializer/#3-the-primarykeyrelatedfield">3- The PrimaryKeyRelatedField</a>
          </li>
        </ul>
      </li>
      <li class="ps-0.5">
        <a class="no-underline hover:underline" href="https://malnossi.github.io/blog/drf-primarylink-serializer/#final-words">Final words</a>
      </li>
    </ul>
  </details>
</nav>

  <!-- Content -->
  <section><h2 id="introduction"><a class="zola-anchor" href="#introduction" aria-label="Anchor link for: introduction">Introduction</a></h2>
<p><a href="https://www.django-rest-framework.org/">Django REST Framework</a> is an amazing librairy built on top of Python's most powerful web framework <a href="https://docs.djangoproject.com/">Django</a>. It is one of the best features to add to Django. But as always, nothing is perfect and to get the best out of this framework, you have to tinker with a few things around it.
There's always one thing that annoys me when I use this framework, that's how serializers behave when it comes to retrieving and validating data.</p>
<h4 id="example"><a class="zola-anchor" href="#example" aria-label="Anchor link for: example">Example</a></h4>
<p>Let's imagine that we have theses Models:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>serializers
</span><span style="color:#b48ead;">from .</span><span>models </span><span style="color:#b48ead;">import </span><span>(Department, Employee,)
</span><span>
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">DepartmentSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>
</span><span>        model = Department
</span><span>        fields = &#39;</span><span style="color:#a3be8c;">__all__</span><span>&#39;
</span><span>
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">EmployeeSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>
</span><span>        model = Employee
</span><span>        fields = &#39;</span><span style="color:#a3be8c;">__all__</span><span>&#39;
</span></code></pre>
<blockquote>
<p><em>I assume that you know how to build views or viewsets and write the urlpatterns to use an api which expose Employees and Departments, if not! It's time to go and look at the DRF and Django documentations.</em></p>
</blockquote>
<h4 id="what-we-can-get"><a class="zola-anchor" href="#what-we-can-get" aria-label="Anchor link for: what-we-can-get">What we can get</a></h4>
<p>Choices that we can get from this example:</p>
<pre data-lang="js" style="background-color:#2b303b;color:#c0c5ce;" class="language-js "><code class="language-js" data-lang="js"><span style="color:#65737e;">// GET /api/v1/employees/1
</span><span>{
</span><span>    &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;:</span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">employee_name</span><span>&quot;:&quot;</span><span style="color:#a3be8c;">mohamed</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">department</span><span>&quot;:</span><span style="color:#d08770;">1
</span><span>}
</span></code></pre>
<p>Not so practical to read, we want more information about the department. But so efficient when writing</p>
<pre data-lang="js" style="background-color:#2b303b;color:#c0c5ce;" class="language-js "><code class="language-js" data-lang="js"><span style="color:#65737e;">//POST /api/v1/employees/
</span><span>{
</span><span>    &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;:</span><span style="color:#d08770;">2</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">employee_name</span><span>&quot;:&quot;</span><span style="color:#a3be8c;">another employee_name that we want to create</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">department</span><span>&quot;:</span><span style="color:#d08770;">1
</span><span>}
</span></code></pre>
<p>We can play with depth property of the serializer by example</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">EmployeeSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>
</span><span>        model = Employee
</span><span>        fields = &#39;</span><span style="color:#a3be8c;">__all__</span><span>&#39;
</span><span>        depth = </span><span style="color:#d08770;">1
</span></code></pre>
<p>We get this</p>
<pre data-lang="js" style="background-color:#2b303b;color:#c0c5ce;" class="language-js "><code class="language-js" data-lang="js"><span style="color:#65737e;">// GET /api/v1/employees/1
</span><span>{
</span><span>    &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;:</span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">employee_name</span><span>&quot;:&quot;</span><span style="color:#a3be8c;">mohamed</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">department</span><span>&quot;:{
</span><span>        &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;:</span><span style="color:#d08770;">1</span><span>,
</span><span>        &quot;</span><span style="color:#a3be8c;">name</span><span>&quot;:&quot;</span><span style="color:#a3be8c;">Information technology</span><span>&quot;
</span><span>    }
</span><span>}
</span></code></pre>
<p>But if we want to create a new <code>employee_name</code> we should send all the department object again, here in this example we don't have so much informations but what if we have a model with multiple nested relations, it will be so annoying</p>
<pre data-lang="js" style="background-color:#2b303b;color:#c0c5ce;" class="language-js "><code class="language-js" data-lang="js"><span style="color:#65737e;">// POST /api/v1/employees/
</span><span>{
</span><span>    &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;:</span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">employee_name</span><span>&quot;:&quot;</span><span style="color:#a3be8c;">mohamed</span><span>&quot;,
</span><span>    &quot;</span><span style="color:#a3be8c;">department</span><span>&quot;:{
</span><span>        &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;:</span><span style="color:#d08770;">1</span><span>,
</span><span>        &quot;</span><span style="color:#a3be8c;">name</span><span>&quot;:&quot;</span><span style="color:#a3be8c;">Information technology</span><span>&quot;,
</span><span>        &quot;</span><span style="color:#a3be8c;">section</span><span>&quot;:</span><span style="color:#d08770;">1
</span><span>    },
</span><span>    &quot;</span><span style="color:#a3be8c;">issues</span><span>&quot;:[
</span><span>        {
</span><span>            &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;:</span><span style="color:#d08770;">1</span><span>,
</span><span>            &quot;</span><span style="color:#a3be8c;">title</span><span>&quot;:&quot;</span><span style="color:#a3be8c;">Optimizing fetch in the frontend</span><span>&quot;
</span><span>        }
</span><span>    ]
</span><span>    </span><span style="color:#65737e;">// and so go on
</span><span>}
</span></code></pre>
<h2 id="solutions"><a class="zola-anchor" href="#solutions" aria-label="Anchor link for: solutions">Solutions</a></h2>
<h4 id="1-use-nested-serializers"><a class="zola-anchor" href="#1-use-nested-serializers" aria-label="Anchor link for: 1-use-nested-serializers">1- Use nested serializers</a></h4>
<p>We can here use the DepartmentSerializer to retrieve the nested relation informations. But this will be a read only field as described in DRF documentation:</p>
<blockquote>
<p><em>By default nested serializers are read-only. If you want to support write-operations to a nested serializer field you'll need to create create() and/or update() methods in order to explicitly specify how the child relationships should be saved "Django REST Framework documentation" you can see <a href="https://www.django-rest-framework.org/api-guide/relations/##writable-nested-serializers">here</a></em></p>
</blockquote>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">EmployeeSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    department = </span><span style="color:#bf616a;">DepartmentSerializer</span><span>() </span><span style="color:#65737e;">## assume you have created the Departement serializer class
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>
</span><span>        model = Employee
</span><span>        fields = &#39;</span><span style="color:#a3be8c;">__all__</span><span>&#39;
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">create</span><span>(</span><span style="color:#bf616a;">self</span><span>,</span><span style="color:#bf616a;">validated_data</span><span>):
</span><span>        department_data = validated_data.</span><span style="color:#bf616a;">pop</span><span>(&#39;</span><span style="color:#a3be8c;">department</span><span>&#39;)
</span><span>        department = Department.objects.</span><span style="color:#bf616a;">create</span><span>(**department_data)
</span><span>        employee = </span><span style="color:#bf616a;">Employee</span><span>(</span><span style="color:#bf616a;">department</span><span>=department,**validated_data)
</span><span>        employee.</span><span style="color:#bf616a;">save</span><span>()
</span><span>        </span><span style="color:#b48ead;">return </span><span>employee
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">update</span><span>(</span><span style="color:#bf616a;">self</span><span>,</span><span style="color:#bf616a;">instance</span><span>, </span><span style="color:#bf616a;">validated_data</span><span>):
</span><span>        department = validated_data.</span><span style="color:#bf616a;">pop</span><span>(&#39;</span><span style="color:#a3be8c;">department</span><span>&#39;)
</span><span>        department, created = Department.objects.</span><span style="color:#bf616a;">get_or_create</span><span>(**department_data)
</span><span>        instance.department = department
</span><span>        instance.</span><span style="color:#bf616a;">save</span><span>()
</span><span>        </span><span style="color:#b48ead;">return </span><span>instance
</span></code></pre>
<p>Again, here we have a very simple example, but with multiple nested serializers this will become very long and very hard to maintain. So very good solution to read data but not so easy to write these relations</p>
<h4 id="2-use-two-serializers-one-to-read-data-and-the-other-to-write-it"><a class="zola-anchor" href="#2-use-two-serializers-one-to-read-data-and-the-other-to-write-it" aria-label="Anchor link for: 2-use-two-serializers-one-to-read-data-and-the-other-to-write-it">2- Use two serializers one to read data and the other to write it</a></h4>
<p>We can use two serializers to make it easier to read and write data. However, we need to change the behaviour of our views or viewsets. So, to read the data (with GET http verb) or with (list, retrieve viewset actions) we use the ReadSerializer and to write the data with (POSt, PUT http verbs) or with (create, update viewset actions) we use the WriteSerializer.</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>serializers
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">EmployeeReadSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    department = </span><span style="color:#bf616a;">DepartmentSerializer</span><span>()
</span><span>
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>
</span><span>        model = Employee
</span><span>        fields = &#39;</span><span style="color:#a3be8c;">__all__</span><span>&#39;
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">EmployeeWriteSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>
</span><span>        model = Employee
</span><span>        fields = &#39;</span><span style="color:#a3be8c;">__all__</span><span>&#39;
</span></code></pre>
<p>And in the ViewSet or View we can override the get_serializer_class methode to explicitly specify which serializer to use depending on which action we make:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>viewsets
</span><span>
</span><span style="color:#b48ead;">from .</span><span>models </span><span style="color:#b48ead;">import </span><span>Employee
</span><span style="color:#b48ead;">from .</span><span>serializers </span><span style="color:#b48ead;">import </span><span>(EmployeeReadSerializer, EmployeeWriteSerializer,)
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">EmployeeViewSet</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">viewsets.ModelViewSet</span><span style="color:#eff1f5;">):
</span><span>
</span><span>    queryset = Employee.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_serializer_class</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.action in [&quot;</span><span style="color:#a3be8c;">create</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">update</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">partial_update</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">destroy</span><span>&quot;]:
</span><span>            </span><span style="color:#b48ead;">return </span><span>EmployeeWriteSerializer
</span><span>        </span><span style="color:#b48ead;">return </span><span>EmployeeReadSerializer
</span></code></pre>
<p>This solution may work, but you're writing almost the same serializer twice, and you're overriding the method in the viewset, so there's more code to write. Not very funny.</p>
<h4 id="3-the-primarykeyrelatedfield"><a class="zola-anchor" href="#3-the-primarykeyrelatedfield" aria-label="Anchor link for: 3-the-primarykeyrelatedfield">3- The PrimaryKeyRelatedField</a></h4>
<p>Finally, we come to the purpose of this article. Here I'm going to tell you about this little trick I found.</p>
<p>Looking at the DRF <a href="https://github.com/encode/django-rest-framework/tree/master">source-code</a>, especially the ModelSerializer class, I noticed that it automatically generates a <code>PrimaryKeyRelatedField</code> for the model's relationships. which itself makes the link via the Id.</p>
<p>So, the idea here is to inherit from this Class in order to build our own PrimaryKeyRelatedField:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">from </span><span>collections </span><span style="color:#b48ead;">import </span><span>OrderedDict
</span><span style="color:#b48ead;">from </span><span>rest_framework </span><span style="color:#b48ead;">import </span><span>serializers
</span><span>
</span><span style="color:#65737e;">## Here I give this class the name of TheAmazingField you can name it whatever you want
</span><span>
</span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">TheAmazingField</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.PrimaryKeyRelatedField</span><span style="color:#eff1f5;">):
</span><span>
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#96b5b4;">__init__</span><span>(</span><span style="color:#bf616a;">self</span><span>,</span><span style="color:#bf616a;">serializer</span><span>, </span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#d08770;">False</span><span>,*</span><span style="color:#bf616a;">args</span><span>,**</span><span style="color:#bf616a;">kwargs</span><span>) -&gt; </span><span style="color:#d08770;">None</span><span>:
</span><span>        </span><span style="color:#96b5b4;">super</span><span>().</span><span style="color:#96b5b4;">__init__</span><span>(*args,**kwargs)
</span><span>        </span><span style="color:#bf616a;">self</span><span>.serializer = serializer
</span><span>        </span><span style="color:#bf616a;">self</span><span>.many=many
</span><span>
</span><span>    </span><span style="color:#65737e;">## When read data we need all the serialized object not only the Id
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">to_representation</span><span>(</span><span style="color:#bf616a;">self</span><span>,</span><span style="color:#bf616a;">value</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">serializer</span><span>(</span><span style="color:#bf616a;">instance</span><span>=value, </span><span style="color:#bf616a;">many</span><span>=</span><span style="color:#bf616a;">self</span><span>.many).data
</span><span>
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    I use a small but not mandatory trick to help you reduce typing:
</span><span style="color:#65737e;">    make sure the queryset of the serialized model is automatically
</span><span style="color:#65737e;">    inherited. I am very lazy
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_queryset</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">if </span><span style="color:#bf616a;">self</span><span>.queryset:
</span><span>            </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">self</span><span>.queryset
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">self</span><span>.serializer.Meta.model.objects.</span><span style="color:#bf616a;">all</span><span>()
</span><span>
</span><span>    </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">    Get choices is used by the DRF autodoc and expects to_representation()
</span><span style="color:#65737e;">    to return an ID, which causes everything to crash.
</span><span style="color:#65737e;">    We rewrite the trick to use item.pk instead of to_representation()
</span><span style="color:#65737e;">    &quot;&quot;&quot;
</span><span>    </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">get_choices</span><span>(</span><span style="color:#bf616a;">self</span><span>, </span><span style="color:#bf616a;">cutoff</span><span>=</span><span style="color:#d08770;">None</span><span>):
</span><span>        queryset = </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">get_queryset</span><span>()
</span><span>        </span><span style="color:#b48ead;">if </span><span>queryset is </span><span style="color:#d08770;">None</span><span>:
</span><span>            </span><span style="color:#b48ead;">return </span><span>{}
</span><span>
</span><span>        </span><span style="color:#b48ead;">if </span><span>cutoff is not </span><span style="color:#d08770;">None</span><span>:
</span><span>            queryset = queryset[:cutoff]
</span><span>
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#bf616a;">OrderedDict</span><span>([
</span><span>            (
</span><span>                item.pk,
</span><span>                </span><span style="color:#bf616a;">self</span><span>.</span><span style="color:#bf616a;">display_value</span><span>(item)
</span><span>            )
</span><span>            </span><span style="color:#b48ead;">for </span><span>item </span><span style="color:#b48ead;">in </span><span>queryset
</span><span>        ])
</span><span>
</span><span>        </span><span style="color:#65737e;">&quot;&quot;&quot;
</span><span style="color:#65737e;">        DRF skips certain validations when there is only the id,
</span><span style="color:#65737e;">        and as this is not the case here, everything crashes. We disable this.
</span><span style="color:#65737e;">        &quot;&quot;&quot;
</span><span>        </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">use_pk_only_optimization</span><span>(</span><span style="color:#bf616a;">self</span><span>):
</span><span>        </span><span style="color:#b48ead;">return </span><span style="color:#d08770;">False
</span></code></pre>
<p>Then we can use it like this:</p>
<pre data-lang="python" style="background-color:#2b303b;color:#c0c5ce;" class="language-python "><code class="language-python" data-lang="python"><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">EmployeeSerializer</span><span style="color:#eff1f5;">(</span><span style="color:#a3be8c;">serializers.ModelSerializer</span><span style="color:#eff1f5;">):
</span><span>    department = </span><span style="color:#bf616a;">TheAmazingField</span><span>(</span><span style="color:#bf616a;">serializer</span><span>=DepartmentSerializer)
</span><span style="color:#eff1f5;">    </span><span style="color:#b48ead;">class </span><span style="color:#ebcb8b;">Meta</span><span style="color:#eff1f5;">:
</span><span>        model = Employee
</span><span>        fields = &#39;</span><span style="color:#a3be8c;">__all__</span><span>&#39;
</span></code></pre>
<p>So when we POST a new employee to the endpoint:</p>
<pre data-lang="js" style="background-color:#2b303b;color:#c0c5ce;" class="language-js "><code class="language-js" data-lang="js"><span style="color:#65737e;">// POST api/v1/employees/
</span><span>{
</span><span>    &quot;</span><span style="color:#a3be8c;">department</span><span>&quot;: </span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">employee_name</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">this works</span><span>&quot;
</span><span>}
</span></code></pre>
<p>The response of the API will retrieve directly the department object ðŸŽ‰</p>
<pre data-lang="js" style="background-color:#2b303b;color:#c0c5ce;" class="language-js "><code class="language-js" data-lang="js"><span>{
</span><span>    &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;: </span><span style="color:#d08770;">1</span><span>,
</span><span>    &quot;</span><span style="color:#a3be8c;">department</span><span>&quot;: {
</span><span>        &quot;</span><span style="color:#a3be8c;">id</span><span>&quot;: </span><span style="color:#d08770;">1</span><span>,
</span><span>        &quot;</span><span style="color:#a3be8c;">name</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">Information Technology</span><span>&quot;
</span><span>    },
</span><span>    &quot;</span><span style="color:#a3be8c;">employee_name</span><span>&quot;: &quot;</span><span style="color:#a3be8c;">this works</span><span>&quot;
</span><span>}
</span></code></pre>
<h2 id="final-words"><a class="zola-anchor" href="#final-words" aria-label="Anchor link for: final-words">Final words</a></h2>
<p>I don't claim to be an expert on Django's REST Framework, but the solution I've found here has enabled me to make progress on my projects, and when I've presented it to my colleagues, they've been pleased. However, I'd be happy to talk to anyone who would like to improve or criticise this solution.</p>
<p>Also, you can refer to this <a href="https://github.com/malnossi/theamazingfield">github repo</a> if you want to see the source-code of the solution I mentioned in this article.</p>
</section>
  <hr />
  <!-- Post Taxonomies -->
<footer class="mt-12 flex flex-col" tabindex="-1" accesskey="_">
  <div class="mb-2 flex flex-wrap">
    <span class="block-bg mr-1.5 mb-1.5 rounded-lg px-5 py-1.5">Tags</span>
    
    <a
      class="block-bg block-hover mr-1.5 mb-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://malnossi.github.io/tags/django/">Django</a>
    
    <a
      class="block-bg block-hover mr-1.5 mb-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://malnossi.github.io/tags/drf/">DRF</a>
    
    <a
      class="block-bg block-hover mr-1.5 mb-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://malnossi.github.io/tags/python/">Python</a>
    
  </div>
</footer>

  <!-- Post Nav -->
<nav class="block-bg mt-12 flex flex-wrap rounded-lg text-lg">
  <a
    class="block-hover-mask flex min-w-[50%] grow items-center rounded-l-md p-6 pr-3 font-semibold no-underline"
    href="https://malnossi.github.io/blog/django-vue/" accesskey=","
    ><span class="mr-1.5">&#8249;</span><span>Integrating Vue into a Django project doesnâ€™t require heavy tooling.  This piece outlines a strategy where the Vue dev server handles local development while Django serves the built files in production, enabling gradual migration from a monolith to a microservice</span></a>
</nav>

  <!-- Begin Page End inject -->
  
  <!-- End Page End inject -->
</article>

  </main>
  <!-- Footer -->
<footer class="mx-auto flex lg:mt-5 max-w-3xl flex-wrap items-center px-4 py-3 text-sm opacity-60">
  <div class="mr-auto basis-full lg:basis-1/2">
  Â© <time datetime="2025">2025</time> Mohamed Nossirat
  </div>
  <div class="flex basis-full lg:basis-1/2 lg:justify-end">
    <span class="mr-6 lg:ml-6">
      <a class="link" href="https://www.getzola.org/" target="_blank">Powered by Zola</a>
    </span>
    <a class="link" href="https://www.getzola.org/themes/linkita/" target="_blank">&#9998; Linkita</a>
  </div>
  <!-- Begin Footer inject -->
  
  <!-- End Footer inject -->
</footer>

  

  <!-- Begin Body End inject -->
  

  <script src="https:&#x2F;&#x2F;cdnapp.websitepolicies.net&#x2F;widgets&#x2F;cookies&#x2F;mzad7vzz.js" defer></script>



<script>
  // If your cookie widget exposes callbacks, flip GA consent when accepted.
  // Adjust to your providerâ€™s API.
  window.addEventListener('CookieConsentAccepted', function () {
    if (window.gtag) {
      gtag('consent', 'update', { analytics_storage: 'granted' });
    }
  });
</script>
  <!-- End Body End inject -->
</body>

</html>
